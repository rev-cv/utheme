import re
from transliterate import translit

def generate_slug(text):
    """
    Создает чистый латинский slug из любого текста (греческий, кириллица и т.д.)
    """
    # 1. Отсекаем лишнее после разделителей
    title_part = re.split(r'[|\-:\?\.!,()—–]', text)[0].strip()
    
    # 2. Транслитерируем в латиницу (автоматически определяет язык)
    try:
        # Если греческий или кириллица — переводим в латиницу
        slug = translit(title_part, reversed=True)
    except:
        # Если транслитерация не поддерживается для этого языка, оставляем как есть
        slug = title_part

    # 3. В нижний регистр
    slug = slug.lower()
    
    # 4. Заменяем специфические греческие/другие символы, если транслит пропустил
    # Например, иногда 'и' или 'й' могут вести себя странно
    
    # 5. Оставляем только латиницу, цифры и дефисы
    slug = re.sub(r'[^a-z0-9\s-]', '', slug)
    
    # 6. Пробелы в дефисы, удаляем дубли дефисов
    slug = re.sub(r'[\s-]+', '-', slug).strip('-')
    
    return slug