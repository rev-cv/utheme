@use "../conf.scss" as conf;
@use "../funcs.scss" as f;

/* =========================================
   1. ПЕРЕМЕННЫЕ (VARIABLES)
   ========================================= */

// Цвета фона
$det-bg-light: #ffffff;
$det-bg-dark: rgba(255, 255, 255, 0.03);

// Цвета границ
$det-border-light: rgba(0, 0, 0, 0.08);
$det-border-dark: rgba(255, 255, 255, 0.1);

// Цвета текста
$det-text-main: conf.$color-text-light;
$det-text-main-dark: conf.$color-text-dark;

// Акцентный цвет (стрелки, ховер)
$det-accent: conf.$color-accent-light;
$det-accent-dark: conf.$color-accent-dark;

// Размеры и отступы
$det-padding-y: 1rem;
$det-padding-x: 1.25rem;

// Анимация
$det-transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

/* =========================================
   2. СТИЛИ БЛОКА (STYLES)
   ========================================= */

@mixin styles {
    .wp-block-details {
        display: block;
        margin-bottom: 1.5rem;

        background-color: $det-bg-light;
        border-radius: f.get-radius();

        overflow: hidden;
        transition: box-shadow $det-transition, border-color $det-transition;
        user-select: none;

        @if conf.$is-border =='true' {
            border: 1px solid $det-border-light;
        }

        @media (prefers-color-scheme: dark) {
            background-color: $det-bg-dark;
            border-color: $det-border-dark;
        }

        // Эффект при наведении на весь блок
        &:hover {
            border-color: rgba($det-accent, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);

            @media (prefers-color-scheme: dark) {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);

                @if conf.$is-border =='true' {
                    border-color: rgba($det-accent-dark, 0.4);
                }
            }
        }

        // Состояние: Открыто
        &[open] {
            border-color: rgba($det-accent, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);

            @media (prefers-color-scheme: dark) {
                border-color: rgba($det-accent-dark, 0.3);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
        }

        /* --- ЗАГОЛОВОК (SUMMARY) --- */
        summary {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;

            padding: $det-padding-y $det-padding-x;

            font-weight: 600;
            font-size: 1.05em;
            line-height: 1.4;
            color: $det-text-main;

            cursor: pointer;
            list-style: none;
            outline: none;
            transition: background-color 0.2s ease, color 0.2s ease;

            @media (prefers-color-scheme: dark) {
                color: $det-text-main-dark;
            }

            // Скрываем стандартный маркер
            &::-webkit-details-marker {
                display: none;
            }

            // Кастомная стрелка
            &::after {
                content: '';
                display: block;
                width: 0.5em;
                height: 0.5em;
                margin-left: 1rem;
                border-right: 2px solid $det-accent;
                border-bottom: 2px solid $det-accent;
                transform: rotate(45deg);
                transition: transform $det-transition;
                flex-shrink: 0;

                @media (prefers-color-scheme: dark) {
                    border-color: $det-accent-dark;
                }
            }

            &:hover {
                background-color: rgba(0, 0, 0, 0.02);
                color: $det-accent;

                @media (prefers-color-scheme: dark) {
                    background-color: rgba(255, 255, 255, 0.02);
                    color: $det-accent-dark;
                }
            }
        }

        /* --- ОТКРЫТЫЙ ЗАГОЛОВОК --- */
        &[open] summary {
            border-bottom: 1px solid $det-border-light;

            @media (prefers-color-scheme: dark) {
                border-bottom-color: $det-border-dark;
            }

            // Поворот стрелки вверх
            &::after {
                transform: rotate(225deg);
                margin-top: 0.2em;
            }
        }

        /* --- КОНТЕНТ --- */
        &>*:not(summary) {
            padding: $det-padding-y $det-padding-x;
            margin: 0;
            animation: detSlideDown 0.3s ease-out forwards;
        }

        p:not(:last-child) {
            margin-bottom: 1em;
        }

        section {
            margin-left: 14px !important;
            margin-right: 14px !important;
        }
    }

    @keyframes detSlideDown {
        from {
            opacity: 0;
            transform: translateY(-8px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
}